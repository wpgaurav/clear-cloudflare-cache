"use strict";var g=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var R=(t,o)=>{for(var s in o)g(t,s,{get:o[s],enumerable:!0})},x=(t,o,s,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of T(o))!Z.call(t,i)&&i!==s&&g(t,i,{get:()=>o[i],enumerable:!(a=E(o,i))||a.enumerable});return t};var L=t=>x(g({},"__esModule",{value:!0}),t);var j={};R(j,{default:()=>C});module.exports=L(j);var e=require("@raycast/api"),l=require("react");var c=require("@raycast/api"),m="https://api.cloudflare.com/client/v4";function y(){let{apiToken:t}=(0,c.getPreferenceValues)();return{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}async function w(){try{let o=await(await fetch(`${m}/zones?per_page=50`,{method:"GET",headers:y()})).json();if(!o.success){let s=o.errors.map(a=>a.message).join(", ");throw new Error(s||"Failed to fetch zones")}return o.result}catch(t){throw console.error("Error fetching zones:",t),t}}async function P(t){try{let s=await(await fetch(`${m}/zones/${t}/purge_cache`,{method:"POST",headers:y(),body:JSON.stringify({purge_everything:!0})})).json();if(!s.success){let a=s.errors.map(i=>i.message).join(", ");throw new Error(a||"Failed to purge cache")}return!0}catch(o){throw console.error("Error purging all cache:",o),o}}async function f(t,o){await(0,c.showToast)({style:c.Toast.Style.Failure,title:t,message:o?.message})}async function S(t){await(0,c.showToast)({style:c.Toast.Style.Success,title:t})}var n=require("react/jsx-runtime");function C(){let[t,o]=(0,l.useState)([]),[s,a]=(0,l.useState)(!0),[i,d]=(0,l.useState)(null);(0,l.useEffect)(()=>{u()},[]);async function u(){a(!0),d(null);try{let r=await w();o(r)}catch(r){let p=r instanceof Error?r.message:"Failed to fetch zones";d(p),await f("Failed to load zones",r instanceof Error?r:void 0)}finally{a(!1)}}async function A(r){if(await(0,e.confirmAlert)({title:"Purge Entire Cache?",message:`This will clear ALL cached content for ${r.name}. This action cannot be undone.`,primaryAction:{title:"Purge All",style:e.Alert.ActionStyle.Destructive}})){await(0,e.showToast)({style:e.Toast.Style.Animated,title:"Purging cache...",message:r.name});try{await P(r.id),await S(`Cache purged for ${r.name}`)}catch(h){await f("Failed to purge cache",h instanceof Error?h:void 0)}}}function b(r){return r.paused?{source:e.Icon.Pause,tintColor:e.Color.Orange}:r.status==="active"?{source:e.Icon.CheckCircle,tintColor:e.Color.Green}:{source:e.Icon.Circle,tintColor:e.Color.SecondaryText}}return i&&t.length===0?(0,n.jsx)(e.List,{children:(0,n.jsx)(e.List.EmptyView,{icon:e.Icon.ExclamationMark,title:"Failed to Load Zones",description:i,actions:(0,n.jsx)(e.ActionPanel,{children:(0,n.jsx)(e.Action,{title:"Retry",icon:e.Icon.ArrowClockwise,onAction:u})})})}):(0,n.jsx)(e.List,{isLoading:s,searchBarPlaceholder:"Search zones...",children:(0,n.jsx)(e.List.Section,{title:"Cloudflare Zones",subtitle:`${t.length} sites`,children:t.map(r=>(0,n.jsx)(e.List.Item,{title:r.name,subtitle:r.id,icon:b(r),accessories:[{tag:{value:r.status,color:r.status==="active"?e.Color.Green:e.Color.SecondaryText}}],actions:(0,n.jsxs)(e.ActionPanel,{children:[(0,n.jsx)(e.ActionPanel.Section,{children:(0,n.jsx)(e.Action,{title:"Purge All Cache",icon:{source:e.Icon.Trash,tintColor:e.Color.Red},style:e.Action.Style.Destructive,onAction:()=>A(r)})}),(0,n.jsxs)(e.ActionPanel.Section,{children:[(0,n.jsx)(e.Action.CopyToClipboard,{title:"Copy Zone ID",content:r.id,shortcut:{modifiers:["cmd"],key:"c"}}),(0,n.jsx)(e.Action.CopyToClipboard,{title:"Copy Domain",content:r.name,shortcut:{modifiers:["cmd","shift"],key:"c"}})]}),(0,n.jsx)(e.ActionPanel.Section,{children:(0,n.jsx)(e.Action,{title:"Refresh Zones",icon:e.Icon.ArrowClockwise,shortcut:{modifiers:["cmd"],key:"r"},onAction:u})})]})},r.id))})})}
